============================= test session starts =============================
platform win32 -- Python 3.12.6, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\gabri\workspace\rohan\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\gabri\workspace\rohan
configfile: pyproject.toml
testpaths: tests
plugins: anyio-4.12.1, langsmith-0.6.6, cov-7.0.0, typeguard-4.4.4
collecting ... collected 296 items

tests/test_agent_metrics.py::test_compute_agent_metrics_pnl PASSED       [  0%]
tests/test_agent_metrics.py::test_compute_agent_metrics_trades PASSED    [  0%]
tests/test_agent_metrics.py::test_compute_agent_metrics_via_strategic_id PASSED [  1%]
tests/test_agent_metrics.py::test_compute_agent_metrics_missing_agent_raises PASSED [  1%]
tests/test_analysis.py::TestAnalysisService::test_compute_simulation_metrics PASSED [  1%]
tests/test_analysis.py::TestAnalysisService::test_generate_price_and_volume_plots PASSED [  2%]
tests/test_analysis.py::TestAnalysisService::test_save_plots_as_binary_artifacts PASSED [  2%]
tests/test_batch_simulation.py::TestBatchSimulation::test_run_batch_with_different_seeds PASSED [  2%]
tests/test_batch_simulation.py::TestBatchSimulation::test_simulation_result_structure PASSED [  3%]
tests/test_batch_simulation.py::TestBatchSimulation::test_settings_builder_variations PASSED [  3%]
tests/test_batch_simulation.py::TestBatchSimulation::test_settings_builder_chaining PASSED [  3%]
tests/test_iteration_pipeline.py::TestIterationPipeline::test_invalid_strategy_returns_validation_errors PASSED [  4%]
tests/test_iteration_pipeline.py::TestIterationPipeline::test_simple_strategy_succeeds PASSED [  4%]
tests/test_iteration_pipeline.py::TestIterationPipeline::test_pipeline_with_persistence PASSED [  4%]
tests/test_llm_factory.py::TestCreateChatModel::test_openrouter_creates_chat_openai PASSED [  5%]
tests/test_llm_factory.py::TestCreateChatModel::test_openai_creates_chat_openai PASSED [  5%]
tests/test_llm_factory.py::TestCreateChatModel::test_missing_openrouter_key_raises PASSED [  5%]
tests/test_llm_factory.py::TestCreateChatModel::test_missing_openai_key_raises PASSED [  6%]
tests/test_llm_factory.py::TestCreateChatModel::test_missing_google_key_raises PASSED [  6%]
tests/test_llm_factory.py::TestCreateChatModel::test_unsupported_provider_raises PASSED [  6%]
tests/test_llm_factory.py::TestConvenienceGetters::test_get_codegen_model PASSED [  7%]
tests/test_llm_factory.py::TestConvenienceGetters::test_get_analysis_model PASSED [  7%]
tests/test_llm_factory.py::TestConvenienceGetters::test_get_judge_model PASSED [  7%]
tests/test_llm_factory.py::TestConvenienceGetters::test_explicit_settings_bypass_cache PASSED [  8%]
tests/test_llm_graph.py::TestValidationRouter::test_no_errors_executes PASSED [  8%]
tests/test_llm_graph.py::TestValidationRouter::test_errors_with_retries_left PASSED [  8%]
tests/test_llm_graph.py::TestValidationRouter::test_errors_at_max_retries_fails PASSED [  9%]
tests/test_llm_graph.py::TestValidationRouter::test_errors_beyond_max_retries_fails PASSED [  9%]
tests/test_llm_graph.py::TestShouldContinue::test_writing_continues PASSED [  9%]
tests/test_llm_graph.py::TestShouldContinue::test_done_stops PASSED      [ 10%]
tests/test_llm_graph.py::TestShouldContinue::test_failed_stops PASSED    [ 10%]
tests/test_llm_graph.py::TestShouldContinue::test_default_stops PASSED   [ 10%]
tests/test_llm_graph.py::TestBuildGraph::test_graph_compiles PASSED      [ 11%]
tests/test_llm_graph.py::TestBuildGraph::test_graph_has_expected_nodes PASSED [ 11%]
tests/test_llm_models.py::TestGeneratedStrategy::test_minimal_creation PASSED [ 11%]
tests/test_llm_models.py::TestGeneratedStrategy::test_required_fields PASSED [ 12%]
tests/test_llm_models.py::TestScenarioExplanation::test_defaults PASSED  [ 12%]
tests/test_llm_models.py::TestScenarioExplanation::test_full_creation PASSED [ 12%]
tests/test_llm_models.py::TestJudgeVerdict::test_valid_verdict PASSED    [ 13%]
tests/test_llm_models.py::TestJudgeVerdict::test_score_bounds PASSED     [ 13%]
tests/test_llm_models.py::TestJudgeVerdict::test_invalid_comparison PASSED [ 13%]
tests/test_llm_models.py::TestJudgeVerdict::test_invalid_recommendation PASSED [ 14%]
tests/test_llm_models.py::TestJudgeVerdict::test_all_recommendations PASSED [ 14%]
tests/test_llm_models.py::TestAggregatedFeedback::test_creation PASSED   [ 14%]
tests/test_llm_models.py::TestScenarioMetrics::test_defaults PASSED      [ 15%]
tests/test_llm_models.py::TestScenarioMetrics::test_full PASSED          [ 15%]
tests/test_llm_models.py::TestIterationSummary::test_creation PASSED     [ 15%]
tests/test_llm_models.py::TestIterationSummary::test_with_metrics PASSED [ 16%]
tests/test_llm_nodes.py::TestWriterNode::test_produces_code PASSED       [ 16%]
tests/test_llm_nodes.py::TestWriterNode::test_includes_validation_errors_as_feedback PASSED [ 16%]
tests/test_llm_nodes.py::TestWriterNode::test_includes_aggregated_feedback PASSED [ 17%]
tests/test_llm_nodes.py::TestValidatorNode::test_valid_code_passes PASSED [ 17%]
tests/test_llm_nodes.py::TestValidatorNode::test_forbidden_import_fails PASSED [ 17%]
tests/test_llm_nodes.py::TestValidatorNode::test_missing_methods_fails PASSED [ 18%]
tests/test_llm_nodes.py::TestValidatorNode::test_no_class_fails PASSED   [ 18%]
tests/test_llm_nodes.py::TestValidatorNode::test_empty_code_fails PASSED [ 18%]
tests/test_llm_nodes.py::TestValidatorNode::test_attempt_counter_increments PASSED [ 19%]
tests/test_llm_nodes.py::TestExplainerNode::test_error_scenario_produces_explanation PASSED [ 19%]
tests/test_llm_nodes.py::TestExplainerNode::test_successful_scenario PASSED [ 19%]
tests/test_llm_nodes.py::TestExplainerNode::test_llm_failure_produces_fallback PASSED [ 20%]
tests/test_llm_nodes.py::TestAggregatorNode::test_produces_feedback_and_history PASSED [ 20%]
tests/test_llm_nodes.py::TestAggregatorNode::test_stop_converged PASSED  [ 20%]
tests/test_llm_nodes.py::TestAggregatorNode::test_max_iterations_reached PASSED [ 21%]
tests/test_llm_nodes.py::TestAggregatorNode::test_llm_failure_defaults_to_continue PASSED [ 21%]
tests/test_llm_nodes.py::TestBuildHistoryTable::test_empty_history PASSED [ 21%]
tests/test_llm_nodes.py::TestBuildHistoryTable::test_single_iteration PASSED [ 22%]
tests/test_llm_nodes.py::TestFormatExplanations::test_empty PASSED       [ 22%]
tests/test_llm_nodes.py::TestFormatExplanations::test_single_explanation PASSED [ 22%]
tests/test_llm_prompts.py::TestWriterPrompts::test_system_prompt_contains_protocol PASSED [ 23%]
tests/test_llm_prompts.py::TestWriterPrompts::test_system_prompt_mentions_types PASSED [ 23%]
tests/test_llm_prompts.py::TestWriterPrompts::test_system_prompt_mentions_allowed_imports PASSED [ 23%]
tests/test_llm_prompts.py::TestWriterPrompts::test_human_prompt_has_slots PASSED [ 24%]
tests/test_llm_prompts.py::TestWriterPrompts::test_human_prompt_renders PASSED [ 24%]
tests/test_llm_prompts.py::TestWriterPrompts::test_feedback_template_renders PASSED [ 25%]
tests/test_llm_prompts.py::TestExplainerPrompts::test_system_prompt_content PASSED [ 25%]
tests/test_llm_prompts.py::TestExplainerPrompts::test_human_prompt_has_slots PASSED [ 25%]
tests/test_llm_prompts.py::TestAggregatorPrompts::test_system_prompt_content PASSED [ 26%]
tests/test_llm_prompts.py::TestAggregatorPrompts::test_human_prompt_has_slots PASSED [ 26%]
tests/test_llm_prompts.py::TestAggregatorPrompts::test_history_table_header PASSED [ 26%]
tests/test_llm_prompts.py::TestAggregatorPrompts::test_history_row_renders PASSED [ 27%]
tests/test_llm_settings.py::TestLLMProvider::test_enum_values PASSED     [ 27%]
tests/test_llm_settings.py::TestLLMProvider::test_enum_membership PASSED [ 27%]
tests/test_llm_settings.py::TestLLMSettings::test_defaults PASSED        [ 28%]
tests/test_llm_settings.py::TestLLMSettings::test_env_override PASSED    [ 28%]
tests/test_llm_settings.py::TestLLMSettings::test_api_key_from_env PASSED [ 28%]
tests/test_llm_settings.py::TestLLMSettings::test_api_key_is_secret PASSED [ 29%]
tests/test_llm_settings.py::TestLLMSettings::test_temperature_bounds PASSED [ 29%]
tests/test_llm_settings.py::TestLLMSettings::test_max_tokens_bounds PASSED [ 29%]
tests/test_llm_settings.py::TestLLMSettings::test_no_api_keys_by_default PASSED [ 30%]
tests/test_llm_state.py::TestScenarioConfig::test_defaults PASSED        [ 30%]
tests/test_llm_state.py::TestScenarioConfig::test_with_overrides PASSED  [ 30%]
tests/test_llm_state.py::TestScenarioConfig::test_serializable PASSED    [ 31%]
tests/test_llm_state.py::TestScenarioResult::test_defaults PASSED        [ 31%]
tests/test_llm_state.py::TestScenarioResult::test_success_result PASSED  [ 31%]
tests/test_llm_state.py::TestScenarioResult::test_error_result PASSED    [ 32%]
tests/test_llm_state.py::TestRefinementState::test_can_construct_initial_state PASSED [ 32%]
tests/test_llm_state.py::TestRefinementState::test_partial_state PASSED  [ 32%]
tests/test_llm_tools.py::TestMakeExplainerTools::test_returns_list_of_tools PASSED [ 33%]
tests/test_llm_tools.py::TestMakeExplainerTools::test_tool_names PASSED  [ 33%]
tests/test_llm_tools.py::TestOrderBookSnapshot::test_returns_bid_ask PASSED [ 33%]
tests/test_llm_tools.py::TestOrderBookSnapshot::test_empty_order_book PASSED [ 34%]
tests/test_llm_tools.py::TestAgentTrades::test_gets_fills PASSED         [ 34%]
tests/test_llm_tools.py::TestAgentTrades::test_no_trades PASSED          [ 34%]
tests/test_llm_tools.py::TestAgentTrades::test_empty_logs PASSED         [ 35%]
tests/test_llm_tools.py::TestPriceStats::test_returns_stats PASSED       [ 35%]
tests/test_llm_tools.py::TestPriceStats::test_empty_data PASSED          [ 35%]
tests/test_llm_tools.py::TestSpreadStats::test_returns_stats PASSED      [ 36%]
tests/test_llm_tools.py::TestSpreadStats::test_empty_data PASSED         [ 36%]
tests/test_llm_tools.py::TestQueryLogs::test_no_filter PASSED            [ 36%]
tests/test_llm_tools.py::TestQueryLogs::test_filter_by_agent_type PASSED [ 37%]
tests/test_llm_tools.py::TestQueryLogs::test_filter_by_event_type PASSED [ 37%]
tests/test_llm_tools.py::TestQueryLogs::test_no_match PASSED             [ 37%]
tests/test_llm_tools.py::TestVolumeProfile::test_returns_profile PASSED  [ 38%]
tests/test_llm_tools.py::TestVolumeProfile::test_empty_logs PASSED       [ 38%]
tests/test_llm_tools.py::TestPnlCurve::test_returns_stats PASSED         [ 38%]
tests/test_llm_tools.py::TestPnlCurve::test_empty_data PASSED            [ 39%]
tests/test_refinement_repository.py::TestRefinementRepository::test_save_session_creates_record PASSED [ 39%]
tests/test_refinement_repository.py::TestRefinementRepository::test_save_session_with_no_iterations PASSED [ 39%]
tests/test_refinement_repository.py::TestRefinementRepository::test_save_session_preserves_scenario_results PASSED [ 40%]
tests/test_refinement_repository.py::TestRefinementRepository::test_list_sessions_empty PASSED [ 40%]
tests/test_refinement_repository.py::TestRefinementRepository::test_list_sessions_returns_summaries PASSED [ 40%]
tests/test_refinement_repository.py::TestRefinementRepository::test_load_session_returns_full_state PASSED [ 41%]
tests/test_refinement_repository.py::TestRefinementRepository::test_load_nonexistent_returns_none PASSED [ 41%]
tests/test_refinement_repository.py::TestRefinementRepository::test_delete_session PASSED [ 41%]
tests/test_refinement_repository.py::TestRefinementRepository::test_delete_nonexistent_returns_false PASSED [ 42%]
tests/test_refinement_repository.py::TestRefinementRepository::test_delete_cascades_children PASSED [ 42%]
tests/test_repository.py::TestDatabaseAndRepository::test_schema_validation PASSED [ 42%]
tests/test_repository.py::TestDatabaseAndRepository::test_create_session_and_scenarios PASSED [ 43%]
tests/test_repository.py::TestDatabaseAndRepository::test_save_and_retrieve_market_data PASSED [ 43%]
tests/test_repository.py::TestDatabaseAndRepository::test_save_and_retrieve_agent_logs PASSED [ 43%]
tests/test_repository.py::TestDatabaseAndRepository::test_save_and_retrieve_artifacts PASSED [ 44%]
tests/test_repository.py::TestDatabaseAndRepository::test_update_simulation_run_status PASSED [ 44%]
tests/test_repository.py::TestDatabaseAndRepository::test_database_connection PASSED [ 44%]
tests/test_reproducibility.py::test_simulation_reproducibility PASSED    [ 45%]
tests/test_saved_models.py::TestSavedScenarioModel::test_create_saved_scenario PASSED [ 45%]
tests/test_saved_models.py::TestSavedScenarioModel::test_saved_scenario_unique_name PASSED [ 45%]
tests/test_saved_models.py::TestSavedScenarioModel::test_saved_scenario_nullable_description PASSED [ 46%]
tests/test_saved_models.py::TestRefinementModels::test_create_refinement_session PASSED [ 46%]
tests/test_saved_models.py::TestRefinementModels::test_iteration_relationship PASSED [ 46%]
tests/test_saved_models.py::TestRefinementModels::test_scenario_result_relationship PASSED [ 47%]
tests/test_saved_models.py::TestRefinementModels::test_cascade_delete PASSED [ 47%]
tests/test_saved_models.py::TestRefinementModels::test_multiple_scenario_results_per_iteration PASSED [ 47%]
tests/test_scenario_repository.py::TestScenarioRepository::test_save_scenario PASSED [ 48%]
tests/test_scenario_repository.py::TestScenarioRepository::test_save_duplicate_name_raises PASSED [ 48%]
tests/test_scenario_repository.py::TestScenarioRepository::test_save_scenario_no_description PASSED [ 48%]
tests/test_scenario_repository.py::TestScenarioRepository::test_list_scenarios_empty PASSED [ 49%]
tests/test_scenario_repository.py::TestScenarioRepository::test_list_scenarios_returns_all PASSED [ 49%]
tests/test_scenario_repository.py::TestScenarioRepository::test_get_scenario_by_id PASSED [ 50%]
tests/test_scenario_repository.py::TestScenarioRepository::test_get_scenario_missing_returns_none PASSED [ 50%]
tests/test_scenario_repository.py::TestScenarioRepository::test_get_scenario_by_name PASSED [ 50%]
tests/test_scenario_repository.py::TestScenarioRepository::test_get_scenario_by_name_missing_returns_none PASSED [ 51%]
tests/test_scenario_repository.py::TestScenarioRepository::test_update_scenario_name PASSED [ 51%]
tests/test_scenario_repository.py::TestScenarioRepository::test_update_scenario_config PASSED [ 51%]
tests/test_scenario_repository.py::TestScenarioRepository::test_update_nonexistent_returns_none PASSED [ 52%]
tests/test_scenario_repository.py::TestScenarioRepository::test_delete_scenario PASSED [ 52%]
tests/test_scenario_repository.py::TestScenarioRepository::test_delete_nonexistent_returns_false PASSED [ 52%]
tests/test_schemas.py::TestOrderBookL1Schema::test_valid_dataframe_passes PASSED [ 53%]
tests/test_schemas.py::TestOrderBookL1Schema::test_nullable_prices PASSED [ 53%]
tests/test_schemas.py::TestOrderBookL1Schema::test_extra_columns_allowed PASSED [ 53%]
tests/test_schemas.py::TestOrderBookL1Schema::test_missing_column_fails PASSED [ 54%]
tests/test_schemas.py::TestOrderBookL1Schema::test_empty_dataframe_passes PASSED [ 54%]
tests/test_schemas.py::TestOrderBookL2Schema::test_valid_dataframe_passes PASSED [ 54%]
tests/test_schemas.py::TestOrderBookL2Schema::test_invalid_side_fails PASSED [ 55%]
tests/test_schemas.py::TestOrderBookL2Schema::test_level_below_one_fails PASSED [ 55%]
tests/test_schemas.py::TestOrderBookL2Schema::test_missing_column_fails PASSED [ 55%]
tests/test_schemas.py::TestAgentLogsSchema::test_valid_dataframe_passes PASSED [ 56%]
tests/test_schemas.py::TestAgentLogsSchema::test_extra_columns_allowed PASSED [ 56%]
tests/test_schemas.py::TestAgentLogsSchema::test_missing_required_column_fails PASSED [ 56%]
tests/test_schemas.py::TestSchemaTypeCoercion::test_l1_time_coerces_to_int64 PASSED [ 57%]
tests/test_schemas.py::TestSchemaTypeCoercion::test_l1_prices_as_int_coerced_to_float PASSED [ 57%]
tests/test_schemas.py::TestSchemaTypeCoercion::test_l1_with_inf_prices_allowed PASSED [ 57%]
tests/test_schemas.py::TestSchemaTypeCoercion::test_l2_level_negative_fails PASSED [ 58%]
tests/test_schemas.py::TestSchemaTypeCoercion::test_l2_side_case_sensitive PASSED [ 58%]
tests/test_schemas.py::TestSchemaTypeCoercion::test_l2_side_accepts_only_bid_or_ask PASSED [ 58%]
tests/test_schemas.py::TestSchemaTypeCoercion::test_logs_agent_id_must_be_numeric PASSED [ 59%]
tests/test_schemas.py::TestSchemaTypeCoercion::test_logs_agent_id_coerces_float_to_int PASSED [ 59%]
tests/test_schemas.py::TestSchemaRealWorldEdgeCases::test_l1_with_all_nan_prices PASSED [ 59%]
tests/test_schemas.py::TestSchemaRealWorldEdgeCases::test_l1_with_zero_quantities PASSED [ 60%]
tests/test_schemas.py::TestSchemaRealWorldEdgeCases::test_l2_with_missing_levels PASSED [ 60%]
tests/test_schemas.py::TestSchemaRealWorldEdgeCases::test_l1_very_large_prices PASSED [ 60%]
tests/test_schemas.py::TestSchemaRealWorldEdgeCases::test_logs_with_many_event_types PASSED [ 61%]
tests/test_simulation_engine.py::TestSimulationEngine::test_run_simulation_and_persist_results PASSED [ 61%]
tests/test_simulation_engine.py::TestSimulationEngine::test_simulation_failure_handling PASSED [ 61%]
tests/test_simulation_impact.py::test_run_with_baseline_impact_calculation PASSED [ 62%]
tests/test_simulation_metrics_validation.py::TestSimulationMetricsValidation::test_all_fields_optional PASSED [ 62%]
tests/test_simulation_metrics_validation.py::TestSimulationMetricsValidation::test_partial_metrics_valid PASSED [ 62%]
tests/test_simulation_metrics_validation.py::TestSimulationMetricsValidation::test_all_metrics_set PASSED [ 63%]
tests/test_simulation_metrics_validation.py::TestSimulationMetricsValidation::test_zero_values_distinct_from_none PASSED [ 63%]
tests/test_simulation_metrics_validation.py::TestSimulationMetricsValidation::test_negative_values_allowed PASSED [ 63%]
tests/test_simulation_metrics_validation.py::TestSimulationMetricsValidation::test_spread_values_in_cents PASSED [ 64%]
tests/test_simulation_metrics_validation.py::TestAgentMetricsValidation::test_minimal_valid_agent_metrics PASSED [ 64%]
tests/test_simulation_metrics_validation.py::TestAgentMetricsValidation::test_cash_fields_are_int_cents PASSED [ 64%]
tests/test_simulation_metrics_validation.py::TestAgentMetricsValidation::test_pnl_is_float_cents PASSED [ 65%]
tests/test_simulation_metrics_validation.py::TestAgentMetricsValidation::test_pnl_can_be_negative PASSED [ 65%]
tests/test_simulation_metrics_validation.py::TestAgentMetricsValidation::test_trade_count_must_be_int PASSED [ 65%]
tests/test_simulation_metrics_validation.py::TestAgentMetricsValidation::test_fill_rate_is_float_ratio PASSED [ 66%]
tests/test_simulation_metrics_validation.py::TestAgentMetricsValidation::test_inventory_fields_are_int PASSED [ 66%]
tests/test_simulation_metrics_validation.py::TestAgentMetricsValidation::test_negative_inventory_allowed PASSED [ 66%]
tests/test_simulation_metrics_validation.py::TestAgentMetricsValidation::test_optional_metrics_none_by_default PASSED [ 67%]
tests/test_simulation_metrics_validation.py::TestMarketMetricsValidation::test_market_metrics_same_shape_as_simulation_metrics PASSED [ 67%]
tests/test_simulation_metrics_validation.py::TestMarketImpactValidation::test_all_fields_optional PASSED [ 67%]
tests/test_simulation_metrics_validation.py::TestMarketImpactValidation::test_positive_delta_pct PASSED [ 68%]
tests/test_simulation_metrics_validation.py::TestMarketImpactValidation::test_negative_delta_pct PASSED [ 68%]
tests/test_simulation_metrics_validation.py::TestMarketImpactValidation::test_zero_delta_pct PASSED [ 68%]
tests/test_simulation_metrics_validation.py::TestComparisonResultValidation::test_comparison_result_composition PASSED [ 69%]
tests/test_simulation_metrics_validation.py::TestComparisonResultValidation::test_comparison_result_all_fields_required PASSED [ 69%]
tests/test_simulation_metrics_validation.py::TestRunSummaryValidation::test_run_summary_minimal PASSED [ 69%]
tests/test_simulation_metrics_validation.py::TestRunSummaryValidation::test_run_summary_with_charts PASSED [ 70%]
tests/test_simulation_metrics_validation.py::TestRunSummaryValidation::test_run_summary_with_error PASSED [ 70%]
tests/test_simulation_metrics_validation.py::TestTypeCoercion::test_int_cash_rejects_fractional_float PASSED [ 70%]
tests/test_simulation_metrics_validation.py::TestTypeCoercion::test_int_cash_accepts_whole_float PASSED [ 71%]
tests/test_simulation_metrics_validation.py::TestTypeCoercion::test_float_pnl_accepts_int PASSED [ 71%]
tests/test_simulation_result.py::TestSimulationResultValidation::test_valid_result_with_error PASSED [ 71%]
tests/test_simulation_result.py::TestSimulationResultValidation::test_valid_result_with_context PASSED [ 72%]
tests/test_simulation_result.py::TestSimulationResultValidation::test_invalid_both_result_and_error PASSED [ 72%]
tests/test_simulation_result.py::TestSimulationResultValidation::test_invalid_neither_result_nor_error PASSED [ 72%]
tests/test_simulation_result.py::TestSimulationResultValidation::test_negative_duration_rejected PASSED [ 73%]
tests/test_simulation_result.py::TestSimulationResultValidation::test_zero_duration_allowed PASSED [ 73%]
tests/test_simulation_result.py::TestSimulationResultValidation::test_result_type_pattern_failure_path PASSED [ 73%]
tests/test_simulation_result.py::TestSimulationResultValidation::test_error_contains_exception_details PASSED [ 74%]
tests/test_simulation_result.py::TestSimulationResultValidation::test_multiple_result_instances_independent PASSED [ 74%]
tests/test_strategic_agent.py::TestStrategyInjection::test_strategy_receives_initialize_callback PASSED [ 75%]
tests/test_strategic_agent.py::TestStrategyInjection::test_strategy_receives_market_data_callbacks PASSED [ 75%]
tests/test_strategic_agent.py::TestStrategyInjection::test_strategy_market_state_has_valid_data PASSED [ 75%]
tests/test_strategic_agent.py::TestStrategyInjection::test_strategy_can_place_orders PASSED [ 76%]
tests/test_strategic_agent.py::TestStrategyInjection::test_on_order_update_called_on_interesting_events PASSED [ 76%]
tests/test_strategic_agent.py::TestStrategyInjection::test_simulation_without_strategy_still_works PASSED [ 76%]
tests/test_strategic_agent.py::TestStrategyInjection::test_cancel_order_works PASSED [ 77%]
tests/test_strategic_agent.py::TestStrategyInjection::test_cancel_all_works PASSED [ 77%]
tests/test_strategic_agent.py::TestStrategyInjection::test_on_tick_called_on_wakeup PASSED [ 77%]
tests/test_strategic_agent.py::TestStrategyInjection::test_market_state_includes_l2_depth PASSED [ 78%]
tests/test_strategic_agent.py::TestStrategyInjection::test_on_simulation_end_called PASSED [ 78%]
tests/test_strategic_agent.py::TestStrategicAgentAdapter::test_adapter_can_be_instantiated PASSED [ 78%]
tests/test_strategy_api_validation.py::TestOrderActionValidation::test_limit_order_with_price_valid PASSED [ 79%]
tests/test_strategy_api_validation.py::TestOrderActionValidation::test_limit_order_without_price_invalid PASSED [ 79%]
tests/test_strategy_api_validation.py::TestOrderActionValidation::test_market_order_without_price_valid PASSED [ 79%]
tests/test_strategy_api_validation.py::TestOrderActionValidation::test_market_order_with_price_invalid PASSED [ 80%]
tests/test_strategy_api_validation.py::TestOrderActionValidation::test_cancel_order_valid PASSED [ 80%]
tests/test_strategy_api_validation.py::TestOrderActionValidation::test_cancel_factory_method PASSED [ 80%]
tests/test_strategy_api_validation.py::TestOrderActionValidation::test_cancel_all_factory_method PASSED [ 81%]
tests/test_strategy_api_validation.py::TestOrderActionValidation::test_cancel_skips_price_validation PASSED [ 81%]
tests/test_strategy_api_validation.py::TestOrderActionValidation::test_quantity_must_be_positive PASSED [ 81%]
tests/test_strategy_api_validation.py::TestPriceTypeValidation::test_order_price_must_be_int PASSED [ 82%]
tests/test_strategy_api_validation.py::TestPriceTypeValidation::test_order_price_float_gets_converted PASSED [ 82%]
tests/test_strategy_api_validation.py::TestPriceTypeValidation::test_order_price_fractional_float_rejected PASSED [ 82%]
tests/test_strategy_api_validation.py::TestPriceTypeValidation::test_market_state_prices_must_be_int PASSED [ 83%]
tests/test_strategy_api_validation.py::TestPriceTypeValidation::test_market_state_nullable_prices PASSED [ 83%]
tests/test_strategy_api_validation.py::TestPriceTypeValidation::test_agent_config_starting_cash_must_be_int PASSED [ 83%]
tests/test_strategy_api_validation.py::TestPriceTypeValidation::test_order_action_price_int_validation PASSED [ 84%]
tests/test_strategy_api_validation.py::TestMarketStateValidation::test_negative_inventory_allowed PASSED [ 84%]
tests/test_strategy_api_validation.py::TestMarketStateValidation::test_zero_cash_allowed PASSED [ 84%]
tests/test_strategy_api_validation.py::TestMarketStateValidation::test_open_orders_can_be_empty PASSED [ 85%]
tests/test_strategy_api_validation.py::TestMarketStateValidation::test_open_orders_with_multiple_orders PASSED [ 85%]
tests/test_strategy_api_validation.py::TestOrderValidation::test_filled_quantity_cannot_exceed_quantity PASSED [ 85%]
tests/test_strategy_api_validation.py::TestOrderValidation::test_partial_fill_valid PASSED [ 86%]
tests/test_strategy_api_validation.py::TestAgentConfigValidation::test_minimal_valid_config PASSED [ 86%]
tests/test_strategy_api_validation.py::TestAgentConfigValidation::test_latency_can_be_positive PASSED [ 86%]
tests/test_strategy_api_validation.py::TestAgentConfigValidation::test_symbol_can_be_custom PASSED [ 87%]
tests/test_strategy_validator.py::TestStrategyValidator::test_valid_strategy_code PASSED [ 87%]
tests/test_strategy_validator.py::TestStrategyValidator::test_forbidden_import PASSED [ 87%]
tests/test_strategy_validator.py::TestStrategyValidator::test_forbidden_attribute PASSED [ 88%]
tests/test_strategy_validator.py::TestStrategyValidator::test_syntax_error PASSED [ 88%]
tests/test_strategy_validator.py::TestStrategyValidator::test_missing_class PASSED [ 88%]
tests/test_strategy_validator.py::TestStrategyValidator::test_missing_methods PASSED [ 89%]
tests/test_strategy_validator.py::TestStrategyValidator::test_runtime_error_in_strategy PASSED [ 89%]
tests/test_strategy_validator.py::TestStrategyValidator::test_safe_builtins_allowed PASSED [ 89%]
tests/test_strategy_validator.py::TestStrategyValidator::test_unsafe_builtins_blocked PASSED [ 90%]
tests/test_ui_presets.py::TestUIPresets::test_get_preset_names_returns_list PASSED [ 90%]
tests/test_ui_presets.py::TestUIPresets::test_get_preset_names_contains_expected_presets PASSED [ 90%]
tests/test_ui_presets.py::TestUIPresets::test_get_preset_config_returns_simulation_settings PASSED [ 91%]
tests/test_ui_presets.py::TestUIPresets::test_get_preset_config_invalid_name_returns_default PASSED [ 91%]
tests/test_ui_presets.py::TestUIPresets::test_default_preset_configuration PASSED [ 91%]
tests/test_ui_presets.py::TestUIPresets::test_high_volatility_preset_configuration PASSED [ 92%]
tests/test_ui_presets.py::TestUIPresets::test_low_liquidity_preset_configuration PASSED [ 92%]
tests/test_ui_presets.py::TestUIPresets::test_market_maker_stress_preset_configuration PASSED [ 92%]
tests/test_ui_presets.py::TestUIPresets::test_momentum_dominated_preset_configuration PASSED [ 93%]
tests/test_ui_presets.py::TestUIPresets::test_all_presets_are_valid PASSED [ 93%]
tests/test_ui_presets.py::TestUIPresets::test_all_presets_have_consistent_time_settings PASSED [ 93%]
tests/test_ui_presets.py::TestUIPresets::test_presets_have_safe_parameter_values PASSED [ 94%]
tests/test_ui_presets.py::TestUIPresets::test_preset_names_are_unique PASSED [ 94%]
tests/test_ui_presets.py::TestUIPresets::test_preset_configurations_are_independent PASSED [ 94%]
tests/test_ui_theme.py::TestUITheme::test_colors_dict_exists PASSED      [ 95%]
tests/test_ui_theme.py::TestUITheme::test_colors_has_required_keys PASSED [ 95%]
tests/test_ui_theme.py::TestUITheme::test_all_colors_are_strings PASSED  [ 95%]
tests/test_ui_theme.py::TestUITheme::test_all_colors_are_valid_hex PASSED [ 96%]
tests/test_ui_theme.py::TestUITheme::test_color_palette_is_bloomberg_inspired PASSED [ 96%]
tests/test_ui_theme.py::TestUITheme::test_background_colors_are_dark PASSED [ 96%]
tests/test_ui_theme.py::TestUITheme::test_text_colors_are_light PASSED   [ 97%]
tests/test_ui_theme.py::TestUITheme::test_success_color_is_green_ish PASSED [ 97%]
tests/test_ui_theme.py::TestUITheme::test_danger_color_is_red_ish PASSED [ 97%]
tests/test_ui_theme.py::TestUITheme::test_muted_text_is_less_bright_than_main_text PASSED [ 98%]
tests/test_ui_theme.py::TestUITheme::test_colors_are_not_empty_strings PASSED [ 98%]
tests/test_ui_theme.py::TestUITheme::test_colors_dict_is_immutable_reference PASSED [ 98%]
tests/test_ui_theme.py::TestUITheme::test_color_contrast_ratios PASSED   [ 99%]
tests/test_ui_theme.py::TestUITheme::test_colors_count PASSED            [ 99%]
tests/test_ui_theme.py::TestUITheme::test_no_duplicate_color_values PASSED [100%]

============================== warnings summary ===============================
.venv\Lib\site-packages\google\protobuf\internal\well_known_types.py:91
  C:\Users\gabri\workspace\rohan\.venv\Lib\site-packages\google\protobuf\internal\well_known_types.py:91: DeprecationWarning: datetime.datetime.utcfromtimestamp() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.fromtimestamp(timestamp, datetime.UTC).
    _EPOCH_DATETIME_NAIVE = datetime.datetime.utcfromtimestamp(0)

tests/test_iteration_pipeline.py::TestIterationPipeline::test_simple_strategy_succeeds
tests/test_iteration_pipeline.py::TestIterationPipeline::test_simple_strategy_succeeds
tests/test_iteration_pipeline.py::TestIterationPipeline::test_pipeline_with_persistence
tests/test_iteration_pipeline.py::TestIterationPipeline::test_pipeline_with_persistence
tests/test_simulation_engine.py::TestSimulationEngine::test_run_simulation_and_persist_results
  C:\Users\gabri\workspace\rohan\src\rohan\framework\analysis_service.py:35: FutureWarning: The default fill_method='pad' in Series.pct_change is deprecated and will be removed in a future version. Either fill in any non-leading NA values prior to calling pct_change or specify 'fill_method=None' to not fill NA values.
    l1["returns"] = l1["mid_price"].pct_change().fillna(0)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.12.6-final-0 _______________

Name                                                           Stmts   Miss   Cover   Missing
---------------------------------------------------------------------------------------------
src\rohan\__init__.py                                              3      0 100.00%
src\rohan\config\__init__.py                                       7      0 100.00%
src\rohan\config\agent_settings.py                               128     15  88.28%   64, 66, 74, 76, 84, 86, 124, 126, 134, 141, 159, 167, 169, 177, 179
src\rohan\config\database_settings.py                              7      0 100.00%
src\rohan\config\latency_settings.py                              11      0 100.00%
src\rohan\config\llm_settings.py                                  19      0 100.00%
src\rohan\config\secrets_settings.py                               5      0 100.00%
src\rohan\config\simulation_settings.py                           35      1  97.14%   65
src\rohan\framework\__init__.py                                    7      0 100.00%
src\rohan\framework\analysis_service.py                          148      6  95.95%   49, 84, 291-292, 297-298
src\rohan\framework\database\__init__.py                           4      0 100.00%
src\rohan\framework\database\database_connector.py                59      5  91.53%   41-42, 56, 68, 103
src\rohan\framework\database\init_db.py                           30     23  23.33%   23-25, 34-38, 47-49, 53-70
src\rohan\framework\database\models.py                           151      0 100.00%
src\rohan\framework\iteration_pipeline.py                        124     16  87.10%   155-158, 185-186, 220, 222, 228, 238-240, 244, 246, 345-346
src\rohan\framework\prompts.py                                    18      0 100.00%
src\rohan\framework\refinement_repository.py                      98      6  93.88%   164-166, 291-293
src\rohan\framework\repository.py                                226     54  76.11%   54-63, 82, 92-94, 116, 126, 130, 140-141, 159, 165-167, 194-199, 215-217, 223-229, 263, 310-312, 328-330, 343-345, 363-365, 392-394
src\rohan\framework\scenario_repository.py                        73      7  90.41%   108, 114-116, 134-136
src\rohan\framework\simulation_engine.py                          46      3  93.48%   47, 101-102
src\rohan\llm\__init__.py                                          1      0 100.00%
src\rohan\llm\cli.py                                              37     37   0.00%   8-91
src\rohan\llm\factory.py                                          46      7  84.78%   82-91, 133-135, 171
src\rohan\llm\graph.py                                            50     13  74.00%   143-184
src\rohan\llm\models.py                                           44      0 100.00%
src\rohan\llm\nodes.py                                           204     73  64.22%   181-331
src\rohan\llm\prompts.py                                          10      0 100.00%
src\rohan\llm\state.py                                            36      0 100.00%
src\rohan\llm\tools.py                                            76      2  97.37%   124, 147
src\rohan\simulation\__init__.py                                   4      0 100.00%
src\rohan\simulation\abides_impl\__init__.py                       6      0 100.00%
src\rohan\simulation\abides_impl\abides_config_mapper.py          81      1  98.77%   298
src\rohan\simulation\abides_impl\abides_output.py                 77      3  96.10%   98-101
src\rohan\simulation\abides_impl\random_state_handler.py          14      0 100.00%
src\rohan\simulation\abides_impl\simulation_runner_abides.py      20      0 100.00%
src\rohan\simulation\abides_impl\strategic_agent_adapter.py      119      5  95.80%   149, 200, 277-278, 281
src\rohan\simulation\models\__init__.py                            8      0 100.00%
src\rohan\simulation\models\schemas.py                            30      0 100.00%
src\rohan\simulation\models\simulation_metrics.py                 45      0 100.00%
src\rohan\simulation\models\simulation_output.py                  15      0 100.00%
src\rohan\simulation\models\simulation_result.py                  24      1  95.83%   103
src\rohan\simulation\models\strategy_api.py                       68      0 100.00%
src\rohan\simulation\models\validation.py                          4      0 100.00%
src\rohan\simulation\simulation_runner.py                         17      3  82.35%   24, 42, 53
src\rohan\simulation\simulation_service.py                        36      6  83.33%   69, 84-86, 118, 140
src\rohan\simulation\strategy_validator.py                        79      6  92.41%   90, 97, 152, 196, 218-219
src\rohan\simulation\utils.py                                     39      9  76.92%   32, 34, 49, 51, 59-61, 66, 68
---------------------------------------------------------------------------------------------
TOTAL                                                           2389    302  87.36%
Coverage HTML written to dir htmlcov
================= 296 passed, 6 warnings in 137.71s (0:02:17) =================
